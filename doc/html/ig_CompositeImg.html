
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>CompositeImg</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-09-20"><meta name="DC.source" content="ig_CompositeImg.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>CompositeImg</h1><!--introduction--><p>Contain and analyse groups of images from the same RawImg</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Usage</a></li><li><a href="#2">Arguments</a></li><li><a href="#3">Details</a></li><li><a href="#4">See Also</a></li><li><a href="#5">Examples</a></li></ul></div><h2 id="1">Usage</h2><pre>OBJ = CompositeImg(RAWIMG, CONFIG, PROCTYPE)
OBJ = CompositeImg(NAME, ...)</pre><h2 id="2">Arguments</h2><div><ul><li><tt>RAWIMG</tt> is the <tt>RawImg</tt> object array that will be used to create the <tt>ProcessedImg</tt> child objects in the <tt>CompositeImg</tt> object.</li><li><tt>CONFIG</tt> is the <tt>Config</tt> object that will be used to create the <tt>ProcessedImg</tt> child objects in the <tt>CompositeImg</tt> object.</li><li><tt>PROCTYPE</tt> is the type of <tt>ProcessedImg</tt> child objects that will be created in the <tt>CompositeImg</tt> object.</li><li><tt>NAME</tt> is the name for this <tt>CompositeImg</tt> object.</li></ul></div><h2 id="3">Details</h2><p><tt>CompositeImg</tt> objects are used to contain and analyse groups of processable objects that are derived from the same <tt>RawImg</tt>.  This allows efficient use of memory, since the same <tt>RawImg</tt> object does not need to be duplicated to be analysed in different ways.</p><h2 id="4">See Also</h2><div><ul><li><a href="matlab:doc('CompositeImg')"><tt>CompositeImg</tt> class documentation</a></li><li><a href="matlab:doc('ImgGroup')"><tt>ImgGroup</tt> class documentation</a></li><li><a href="./ig_ImgGroup.html"><tt>ImgGroup</tt> quick start guide</a></li><li><a href="matlab:doc('ProcessedImg')"><tt>ProcessedImg</tt> class documentation</a></li><li><a href="./pi_.html"><tt>ProcessedImg</tt> quick start guide</a></li><li><a href="matlab:doc('Config')"><tt>Config</tt> class documentation</a></li><li><a href="matlab:doc('RawImgComposite')"><tt>RawImgComposite</tt> class documentation</a></li></ul></div><h2 id="5">Examples</h2><p>The following examples require the sample images and other files, which can be downloaded manually, from the University of Zurich website (<a href="http://www.pharma.uzh.ch/en/research/functionalimaging/CHIPS.html">http://www.pharma.uzh.ch/en/research/functionalimaging/CHIPS.html</a>), or automatically, by running the function <tt>utils.download_example_imgs()</tt>.</p><p><h3>Create a <tt>CompositeImg</tt> object interactively from one or more files</h3></p><p>The following example will illustrate the process of creating a <tt>CompositeImg</tt> object interactively.  Although it is possible to do so by using the constructor method followed by the <tt>add()</tt> method, it can be easier to use the static method <tt>from_files</tt>, as illustrated below.</p><pre class="language-matlab"><span class="comment">% Construct an CompositeImg using the static method from_files</span>
ci01 = CompositeImg.from_files()
</pre><p>In order to load a raw image file, we must first select the type of <tt>RawImg</tt> to create.  Press three and then enter to select the SCIM_Tif.</p><pre>----- What type of RawImg would you like to load? -----</pre><pre>  &gt;&gt; 1) BioFormats
     2) RawImgDummy
     3) SCIM_Tif</pre><pre>Select a format: 3</pre><p>Then, use the interactive dialogue box to select the raw image file <tt>xsectscan_scim.tif</tt>, which should be located in the subfolder tests&gt;res, within the CHIPS root directory.</p><p><img vspace="5" hspace="5" src="xss_sel_rawimg.png" alt=""> </p><p>Use the interactive dialogue box to select the dummy calibration (<tt>calibration_dummy.mat</tt>):</p><p><img vspace="5" hspace="5" src="sel_cal.png" alt=""> </p><p>The next stage is to define the 'meaning' of the image channels.  For this example we will specify the first channel as a cellular signal, and the second channel as blood plasma.  Press six and enter, followed by one and enter, to complete the selection.</p><pre>----- What is shown on channel 1? -----</pre><pre>  &gt;&gt; 0) &lt;blank&gt;
     1) blood_plasma
     2) blood_rbcs
     3) Ca_Cyto_Astro
     4) Ca_Memb_Astro
     5) Ca_Neuron
     6) cellular_signal
     7) FRET_ratio</pre><pre>Answer: 6</pre><pre>----- What is shown on channel 2? -----</pre><pre>  &gt;&gt; 0) &lt;blank&gt;
     1) blood_plasma
     2) blood_rbcs
     3) Ca_Cyto_Astro
     4) Ca_Memb_Astro
     5) Ca_Neuron
     6) cellular_signal
     7) FRET_ratio</pre><pre>Answer: 1</pre><p>Since no type of <tt>ProcessedImg</tt> has been specified, we must specify one or more types of <tt>ProcessedImg</tt> to create.  Press five followed by enter, then one followed by enter, then enter, to choose <tt>XSectScan</tt> and <tt>CellScan</tt>.</p><pre>----- Choose as many ProcessedImg classes as you would like -----</pre><pre>  &gt;&gt; 0) &lt;Finished&gt;
     1) CellScan
     2) FrameScan
     3) LineScanDiam
     4) LineScanVel
     5) XSectScan</pre><pre>Select a class: 5</pre><pre>  &gt;&gt; 0) &lt;Finished&gt;
     1) CellScan
     2) FrameScan
     3) LineScanDiam
     4) LineScanVel
     5) XSectScan</pre><pre>Select a class: 1</pre><pre>  &gt;&gt; 0) &lt;Finished&gt;
     1) CellScan
     2) FrameScan
     3) LineScanDiam
     4) LineScanVel
     5) XSectScan</pre><pre>Select a class:</pre><p>Then, we must define the masks (i.e. the relevant part of the raw image) for the different <tt>ProcessedImg</tt> children.  Press four followed by enter, to choose a square mask for the <tt>XSectScan</tt>, then draw a square on the image that appears.  Afterwards, press enter to complete mask selection for the <tt>XSectScan</tt> images.</p><pre>===== Select the masks for the XSectScan images =====</pre><pre>----- Which type of mask would you like to select? -----</pre><pre>  &gt;&gt; 0) &lt;finished&gt;
     1) everything
     2) columns
     3) rows
     4) square
     5) rectangle
     6) polygon
     7) circle
     8) ellipse
     9) freehand
    10) even-lines
    11) odd-lines
    12) channels</pre><pre>Select a maskType: 4</pre><p><img vspace="5" hspace="5" src="ci_sel_square.png" alt=""> </p><pre>----- Which type of mask would you like to select? -----</pre><pre>  &gt;&gt; 0) &lt;finished&gt;
     1) everything
     2) columns
     3) rows
     4) square
     5) rectangle
     6) polygon
     7) circle
     8) ellipse
     9) freehand
    10) even-lines
    11) odd-lines
    12) channels</pre><pre>Select a maskType:</pre><p>We must also define masks for the different <tt>CellScan</tt>.  Press one followed by enter, then enter, to use all of the image.</p><pre>===== Select the masks for the CellScan images =====</pre><pre>----- Which type of mask would you like to select? -----</pre><pre>  &gt;&gt; 0) &lt;finished&gt;
     1) everything
     2) columns
     3) rows
     4) square
     5) rectangle
     6) polygon
     7) circle
     8) ellipse
     9) freehand
    10) even-lines
    11) odd-lines
    12) channels</pre><pre>Select a maskType: 1</pre><pre>----- Which type of mask would you like to select? -----</pre><pre>  &gt;&gt; 0) &lt;finished&gt;
     1) everything
     2) columns
     3) rows
     4) square
     5) rectangle
     6) polygon
     7) circle
     8) ellipse
     9) freehand
    10) even-lines
    11) odd-lines
    12) channels</pre><pre>Select a maskType:</pre><p>Finally, we must select the appropriate <tt>Calc</tt> methods for the <tt>CellScan</tt>.  Press enter three times to choose the defaults.</p><pre>----- Which ROI detection method would you like to use? -----</pre><pre>  &gt;&gt; 1) whole frame
     2) load ImageJ ROIs
     3) load mask from .tif or .mat file
     4) 2D FLIKA (automatic ROI selection)
     5) 2.5D FLIKA (automatic ROI selection)
     6) 3D FLIKA (automatic ROI selection)
     7) CellSort (automatic ROI selection)</pre><pre>Select a detection method, please:</pre><pre>----- Which ROI measuring method would you like to use? -----</pre><pre>  &gt;&gt; 1) simple baseline normalised</pre><pre>Select a measuring method, please:</pre><pre>----- Which signal detection method would you like to use? -----</pre><pre>  &gt;&gt; 1) no signal detection
     2) detect + classify signals</pre><pre>Select a detection method, please:</pre><p>We have now created a <tt>CompositeImg</tt> object interactively.</p><pre>ci01 =</pre><pre class="language-matlab">CompositeImg <span class="string">with</span> <span class="string">properties:</span>
</pre><pre>    imgTypes: {'CellScan'  'XSectScan'}
       masks: {{1x1 cell}  {1x1 cell}}
    children: {[1x1 XSectScan]  [1x1 CellScan]}
   nChildren: 2
       state: 'unprocessed'
        name: 'xsectscan_scim'
      rawImg: [1x1 SCIM_Tif]</pre><p><h3>Prepare a <tt>RawImg</tt> object for use in these examples</h3></p><pre class="codeinput"><span class="comment">% Prepare a RawImg array for use in these examples</span>
fnRawImg = fullfile(utils.CHIPS_rootdir, <span class="string">'tests'</span>, <span class="string">'res'</span>, <span class="keyword">...</span>
    <span class="string">'xsectscan_scim.tif'</span>);
channels = struct(<span class="string">'cellular_signal'</span>, 1, <span class="string">'blood_plasma'</span>, 2);
fnCalibration = fullfile(utils.CHIPS_rootdir, <span class="string">'tests'</span>, <span class="string">'res'</span>, <span class="keyword">...</span>
    <span class="string">'calibration_dummy.mat'</span>);
calibration = CalibrationPixelSize.load(fnCalibration);
rawImg = SCIM_Tif(fnRawImg, channels, calibration)
</pre><pre class="codeoutput">Opening xsectscan_scim.tif: 100% [=================================]
rawImg = 
  SCIM_Tif with properties:

             filename: 'D:\Code\Matlab\2p-img-analysis\tests\res\xsectscan_scim.tif'
           isDenoised: 0
    isMotionCorrected: 0
    metadata_original: [1&times;1 struct]
                 name: 'xsectscan_scim'
              rawdata: [128&times;128&times;2&times;50 uint16]
                   t0: 0
             metadata: [1&times;1 Metadata]
</pre><p><h3>Create a <tt>CompositeImg</tt> object without any interaction</h3></p><pre class="codeinput"><span class="comment">% Prepare a blank mask for convenience, and a square mask for this example</span>
maskBlank = false(rawImg.metadata.nLinesPerFrame, <span class="keyword">...</span>
    rawImg.metadata.nPixelsPerLine);
maskSquare = maskBlank;
maskSquare(20:100, 20:100) = true;

<span class="comment">% Create an ImgGroup object from ProcessedImg objects without any interaction</span>
nameCI02 = <span class="string">'test CI 02'</span>;
configTiRS = ConfigDiameterTiRS(<span class="string">'thresholdFWHM'</span>, 0.65, <span class="keyword">...</span>
    <span class="string">'thresholdInv'</span>, 0.35);
procImgType = <span class="string">'XSectScan'</span>;
ci02 = CompositeImg(nameCI02, rawImg, configTiRS, procImgType, maskSquare)
</pre><pre class="codeoutput">ci02 = 
  CompositeImg with properties:

     imgTypes: {'XSectScan'}
        masks: {{1&times;1 cell}}
     children: {[1&times;1 XSectScan]}
    nChildren: 1
        state: 'unprocessed'
         name: 'test CI 02'
       rawImg: [1&times;1 SCIM_Tif]
</pre><p><h3>Add <tt>RawImg</tt> objects to an existing <tt>CompositeImg</tt> object with a custom config</h3></p><pre class="codeinput"><span class="comment">% Prepare a channel mask for this example</span>
maskChannel = cat(3, true(size(maskBlank)), maskBlank);

<span class="comment">% Add to an existing CompositeImg object with a custom config</span>
procImgType = <span class="string">'CellScan'</span>;
configCS = ConfigCellScan(<span class="keyword">...</span>
    ConfigFindROIsFLIKA_2D(<span class="string">'baselineFrames'</span>, 30, <span class="string">'thresholdPuff'</span>, 4, <span class="keyword">...</span>
        <span class="string">'maxRiseTime'</span>, 30, <span class="string">'minROIArea'</span>, 21), <span class="keyword">...</span>
    ConfigMeasureROIsDummy(<span class="string">'baselineFrames'</span>, 30), <span class="keyword">...</span>
    ConfigDetectSigsDummy());
ci02.add(configCS, procImgType, maskChannel)
ci02
</pre><pre class="codeoutput">ci02 = 
  CompositeImg with properties:

     imgTypes: {'CellScan'  'XSectScan'}
        masks: {{1&times;1 cell}  {1&times;1 cell}}
     children: {[1&times;1 XSectScan]  [1&times;1 CellScan]}
    nChildren: 2
        state: 'unprocessed'
         name: 'test CI 02'
       rawImg: [1&times;1 SCIM_Tif]
</pre><p><h3>Process an <tt>CompositeImg</tt> object (in parallel)</h3></p><pre class="codeinput"><span class="comment">% Process an CompositeImg object (in parallel).</span>
<span class="comment">% This code requires the Parallel Computing Toolbox to run in parallel</span>
useParallel = true;
ci02 = ci02.process(useParallel)
</pre><pre class="codeoutput">Processing children: 100% [========================================]
ci02 = 
  CompositeImg with properties:

     imgTypes: {'CellScan'  'XSectScan'}
        masks: {{1&times;1 cell}  {1&times;1 cell}}
     children: {[1&times;1 XSectScan]  [1&times;1 CellScan]}
    nChildren: 2
        state: 'processed'
         name: 'test CI 02'
       rawImg: [1&times;1 SCIM_Tif]
</pre><p><h3>Plot a figure showing the output from all children</h3></p><pre class="codeinput"><span class="comment">% Plot a figure showing the output from all children.</span>
<span class="comment">% Note: the figures are deliberately displayed smaller here</span>
hFig = ci02.plot();
set(hFig, <span class="string">'Units'</span>, <span class="string">'Pixels'</span>, <span class="string">'Position'</span>, [50, 50, 500, 500]);
</pre><img vspace="5" hspace="5" src="ig_CompositeImg_01.png" alt=""> <img vspace="5" hspace="5" src="ig_CompositeImg_02.png" alt=""> <p><h3>Output the data from all children</h3></p><pre class="codeinput"><span class="comment">% Output the data.  This requires write access to the working directory</span>
fnCSV02 = ci02.output_data(<span class="string">'ci02'</span>, <span class="string">'overwrite'</span>, true);
fID02 = fopen(fnCSV02{end}{1}, <span class="string">'r'</span>);
fileContents02 = textscan(fID02, <span class="string">'%s'</span>);
fileContents02{1}{1:5}
fclose(fID02);
</pre><pre class="codeoutput">Warning: The Data object has no output defined, so no data will be output. 
ans =
    'roiNames,area,centroidX,centroidY'
ans =
    'roi0001_0008_0012,32,13.50000,8.00000'
ans =
    'roi0002_0004_0021,32,22.00000,4.50000'
ans =
    'roi0003_0077_0034,168,38.07143,79.09524'
ans =
    'roi0004_0008_0037,32,38.50000,7.50000'
</pre><p><a href="./index.html">Home</a></p><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% CompositeImg
% Contain and analyse groups of images from the same RawImg

%% Usage
%  OBJ = CompositeImg(RAWIMG, CONFIG, PROCTYPE)
%  OBJ = CompositeImg(NAME, ...)

%% Arguments
% * |RAWIMG| is the |RawImg| object array that will be used to create the
% |ProcessedImg| child objects in the |CompositeImg| object.
% * |CONFIG| is the |Config| object that will be used to create the
% |ProcessedImg| child objects in the |CompositeImg| object.
% * |PROCTYPE| is the type of |ProcessedImg| child objects that will be
% created in the |CompositeImg| object.
% * |NAME| is the name for this |CompositeImg| object.
        
%% Details
% |CompositeImg| objects are used to contain and analyse groups of
% processable objects that are derived from the same |RawImg|.  This allows
% efficient use of memory, since the same |RawImg| object does not need to
% be duplicated to be analysed in different ways.

%% See Also
% * <matlab:doc('CompositeImg') |CompositeImg| class documentation>
% * <matlab:doc('ImgGroup') |ImgGroup| class documentation>
% * <./ig_ImgGroup.html |ImgGroup| quick start guide>
% * <matlab:doc('ProcessedImg') |ProcessedImg| class documentation>
% * <./pi_.html |ProcessedImg| quick start guide>
% * <matlab:doc('Config') |Config| class documentation>
% * <matlab:doc('RawImgComposite') |RawImgComposite| class documentation>

%% Examples
% The following examples require the sample images and other files, which
% can be downloaded manually, from the University of Zurich website
% (<http://www.pharma.uzh.ch/en/research/functionalimaging/CHIPS.html>), or
% automatically, by running the function |utils.download_example_imgs()|.
%
% <html><h3>Create a <tt>CompositeImg</tt> object interactively from one or more files</h3></html>
%
% The following example will illustrate the process of creating a
% |CompositeImg| object interactively.  Although it is possible to do so by
% using the constructor method followed by the |add()| method, it can be
% easier to use the static method |from_files|, as illustrated below.
%
%   % Construct an CompositeImg using the static method from_files
%   ci01 = CompositeImg.from_files()
%
% In order to load a raw image file, we must first select the type of
% |RawImg| to create.  Press three and then enter to select the SCIM_Tif.  
%
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- What type of RawImg would you like to load? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 1) BioFormats
%       2) RawImgDummy
%       3) SCIM_Tif
%  
%  Select a format: 3
%
% Then, use the interactive dialogue box to select the raw image file
% |xsectscan_scim.tif|, which should be located in the subfolder
% tests>res, within the CHIPS root directory.
%
% <<xss_sel_rawimg.png>>
%
% Use the interactive dialogue box to select the dummy calibration 
% (|calibration_dummy.mat|):
%
% <<sel_cal.png>>
%
% The next stage is to define the 'meaning' of the image channels.  For
% this example we will specify the first channel as a cellular signal, and
% the second channel as blood plasma.  Press six and enter, followed by one
% and enter, to complete the selection.
%
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- What is shown on channel 1? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <blank>
%       1) blood_plasma
%       2) blood_rbcs
%       3) Ca_Cyto_Astro
%       4) Ca_Memb_Astro
%       5) Ca_Neuron
%       6) cellular_signal
%       7) FRET_ratio
%  
%  Answer: 6
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- What is shown on channel 2? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <blank>
%       1) blood_plasma
%       2) blood_rbcs
%       3) Ca_Cyto_Astro
%       4) Ca_Memb_Astro
%       5) Ca_Neuron
%       6) cellular_signal
%       7) FRET_ratio
%  
%  Answer: 1
%
% Since no type of |ProcessedImg| has been specified, we must specify one
% or more types of |ProcessedImg| to create.  Press five followed by enter,
% then one followed by enter, then enter, to choose |XSectScan| and
% |CellScan|.
%
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Choose as many ProcessedImg classes as you would like REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- 
%  
%    >> 0) <Finished>
%       1) CellScan
%       2) FrameScan
%       3) LineScanDiam
%       4) LineScanVel
%       5) XSectScan
%  
%  Select a class: 5
%  
%  
%    >> 0) <Finished>
%       1) CellScan
%       2) FrameScan
%       3) LineScanDiam
%       4) LineScanVel
%       5) XSectScan
%  
%  Select a class: 1
%  
%  
%    >> 0) <Finished>
%       1) CellScan
%       2) FrameScan
%       3) LineScanDiam
%       4) LineScanVel
%       5) XSectScan
%  
%  Select a class: 
%
% Then, we must define the masks (i.e. the relevant part of the raw image)
% for the different |ProcessedImg| children.  Press four followed by enter,
% to choose a square mask for the |XSectScan|, then draw a square on the
% image that appears.  Afterwards, press enter to complete mask selection
% for the |XSectScan| images.
%
%  ===== Select the masks for the XSectScan images =====
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which type of mask would you like to select? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <finished>
%       1) everything
%       2) columns
%       3) rows
%       4) square
%       5) rectangle
%       6) polygon
%       7) circle
%       8) ellipse
%       9) freehand
%      10) even-lines
%      11) odd-lines
%      12) channels
%  
%  Select a maskType: 4
%
% <<ci_sel_square.png>>
%
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which type of mask would you like to select? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <finished>
%       1) everything
%       2) columns
%       3) rows
%       4) square
%       5) rectangle
%       6) polygon
%       7) circle
%       8) ellipse
%       9) freehand
%      10) even-lines
%      11) odd-lines
%      12) channels
%  
%  Select a maskType: 
%
% We must also define masks for the different |CellScan|.  Press one
% followed by enter, then enter, to use all of the image.
%
%  ===== Select the masks for the CellScan images =====
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which type of mask would you like to select? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <finished>
%       1) everything
%       2) columns
%       3) rows
%       4) square
%       5) rectangle
%       6) polygon
%       7) circle
%       8) ellipse
%       9) freehand
%      10) even-lines
%      11) odd-lines
%      12) channels
%  
%  Select a maskType: 1
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which type of mask would you like to select? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 0) <finished>
%       1) everything
%       2) columns
%       3) rows
%       4) square
%       5) rectangle
%       6) polygon
%       7) circle
%       8) ellipse
%       9) freehand
%      10) even-lines
%      11) odd-lines
%      12) channels
%  
%  Select a maskType: 
%
% Finally, we must select the appropriate |Calc| methods for the
% |CellScan|.  Press enter three times to choose the defaults.
%
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which ROI detection method would you like to use? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 1) whole frame
%       2) load ImageJ ROIs
%       3) load mask from .tif or .mat file
%       4) 2D FLIKA (automatic ROI selection)
%       5) 2.5D FLIKA (automatic ROI selection)
%       6) 3D FLIKA (automatic ROI selection)
%       7) CellSort (automatic ROI selection)
%  
%  Select a detection method, please: 
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which ROI measuring method would you like to use? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 1) simple baseline normalised
%  
%  Select a measuring method, please: 
%  
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Which signal detection method would you like to use? REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  
%    >> 1) no signal detection
%       2) detect + classify signals
%  
%  Select a detection method, please: 
%
% We have now created a |CompositeImg| object interactively.
%
%  ci01 = 
% 
%   CompositeImg with properties:
% 
%      imgTypes: {'CellScan'  'XSectScan'}
%         masks: {{1x1 cell}  {1x1 cell}}
%      children: {[1x1 XSectScan]  [1x1 CellScan]}
%     nChildren: 2
%         state: 'unprocessed'
%          name: 'xsectscan_scim'
%        rawImg: [1x1 SCIM_Tif]

%%
%
% <html><h3>Prepare a <tt>RawImg</tt> object for use in these examples</h3></html>
%

% Prepare a RawImg array for use in these examples
fnRawImg = fullfile(utils.CHIPS_rootdir, 'tests', 'res', ...
    'xsectscan_scim.tif');
channels = struct('cellular_signal', 1, 'blood_plasma', 2);
fnCalibration = fullfile(utils.CHIPS_rootdir, 'tests', 'res', ...
    'calibration_dummy.mat');
calibration = CalibrationPixelSize.load(fnCalibration);
rawImg = SCIM_Tif(fnRawImg, channels, calibration)

%%
%
% <html><h3>Create a <tt>CompositeImg</tt> object without any interaction</h3></html>
%

% Prepare a blank mask for convenience, and a square mask for this example
maskBlank = false(rawImg.metadata.nLinesPerFrame, ...
    rawImg.metadata.nPixelsPerLine);
maskSquare = maskBlank;
maskSquare(20:100, 20:100) = true;

% Create an ImgGroup object from ProcessedImg objects without any interaction
nameCI02 = 'test CI 02';
configTiRS = ConfigDiameterTiRS('thresholdFWHM', 0.65, ...
    'thresholdInv', 0.35);
procImgType = 'XSectScan';
ci02 = CompositeImg(nameCI02, rawImg, configTiRS, procImgType, maskSquare)

%%
%
% <html><h3>Add <tt>RawImg</tt> objects to an existing <tt>CompositeImg</tt> object with a custom config</h3></html>
%

% Prepare a channel mask for this example
maskChannel = cat(3, true(size(maskBlank)), maskBlank);

% Add to an existing CompositeImg object with a custom config
procImgType = 'CellScan';
configCS = ConfigCellScan(...
    ConfigFindROIsFLIKA_2D('baselineFrames', 30, 'thresholdPuff', 4, ...
        'maxRiseTime', 30, 'minROIArea', 21), ...
    ConfigMeasureROIsDummy('baselineFrames', 30), ...
    ConfigDetectSigsDummy());
ci02.add(configCS, procImgType, maskChannel)
ci02

%%
%
% <html><h3>Process an <tt>CompositeImg</tt> object (in parallel)</h3></html>
%

% Process an CompositeImg object (in parallel).
% This code requires the Parallel Computing Toolbox to run in parallel
useParallel = true;
ci02 = ci02.process(useParallel)

%%
%
% <html><h3>Plot a figure showing the output from all children</h3></html>
%

% Plot a figure showing the output from all children.
% Note: the figures are deliberately displayed smaller here
hFig = ci02.plot();
set(hFig, 'Units', 'Pixels', 'Position', [50, 50, 500, 500]);

%%
%
% <html><h3>Output the data from all children</h3></html>
%

% Output the data.  This requires write access to the working directory
fnCSV02 = ci02.output_data('ci02', 'overwrite', true);
fID02 = fopen(fnCSV02{end}{1}, 'r');
fileContents02 = textscan(fID02, '%s');
fileContents02{1}{1:5}
fclose(fID02);

%%
%
% <./index.html Home>
##### SOURCE END #####
--></body></html>